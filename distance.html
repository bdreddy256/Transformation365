<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distance Calculator with Regional Search</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
        input, button, select { width: 100%; padding: 10px; margin: 5px 0; border-radius: 5px; border: 1px solid #ddd; }
        button { background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        .result { margin-top: 20px; padding: 10px; background-color: #f0f0f0; border-radius: 5px; }
        #map { height: 500px; margin: 10px 0; border-radius: 5px; }
        .search-results { margin-top: 10px; max-height: 200px; overflow-y: auto; }
        .place-item { padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; }
        .place-item:hover { background-color: #f5f5f5; }
        .loading { margin: 10px 0; color: #666; }
    </style>
</head>
<body>
    <h1>Distance Calculator with Regional Search</h1>
    <div>
        <label for="search">Search for a region (city, country, etc.)</label>
        <input type="text" id="search" placeholder="e.g., Dallas, Paris, London">
        <button id="searchBtn">Search Region</button>
        <div id="regionResult" class="result" style="display: none;"></div>
    </div>
    <div>
        <label for="placeSearch">Search for places within the region</label>
        <input type="text" id="placeSearch" placeholder="e.g., restaurant, park, hotel" disabled>
        <button id="placeSearchBtn" disabled>Find Places</button>
        <div id="searchResults" class="search-results"></div>
    </div>
    <div class="coordinates-container">
        <div>
            <h3>Point 1</h3>
            <input type="number" id="lat1" placeholder="Latitude 1" step="any">
            <input type="number" id="lon1" placeholder="Longitude 1" step="any">
        </div>
        <div>
            <h3>Point 2</h3>
            <input type="number" id="lat2" placeholder="Latitude 2" step="any">
            <input type="number" id="lon2" placeholder="Longitude 2" step="any">
        </div>
    </div>
    <button id="calculateBtn">Calculate Distance</button>
    <div id="result" class="result"></div>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const map = L.map('map').setView([20, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        let markers = [];
        let regionBounds = null;
        let regionName = '';

        map.on('click', (e) => {
            const { lat, lng } = e.latlng;
            if (markers.length >= 2) {
                map.removeLayer(markers[1]);
                markers.pop();
            }
            const marker = L.marker([lat, lng]).addTo(map);
            markers.push(marker);
            if (markers.length === 1) {
                document.getElementById('lat1').value = lat;
                document.getElementById('lon1').value = lng;
            } else if (markers.length === 2) {
                document.getElementById('lat2').value = lat;
                document.getElementById('lon2').value = lng;
            }
        });

        document.getElementById('searchBtn').addEventListener('click', function() {
            const query = document.getElementById('search').value;
            if (!query) return;
            document.getElementById('regionResult').innerHTML = 'Searching...';
            document.getElementById('regionResult').style.display = 'block';
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1`)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const { lat, lon, boundingbox, display_name } = data[0];
                        regionBounds = boundingbox.map(Number);
                        map.setView([lat, lon], 12);
                        document.getElementById('regionResult').innerHTML = `<b>Selected region:</b> ${display_name}`;
                        document.getElementById('placeSearch').disabled = false;
                        document.getElementById('placeSearchBtn').disabled = false;
                    }
                });
        });

    </script>
</body>
</html>
